<!-- templates/analisis.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultados del Análisis</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 600px;
        }
    </style>
</head>
<body>
<h1>Resultados del Análisis</h1>

<h2>Punto Crítico: {{ data['punto_critico']['Sector'] }}</h2>
<p>Departamento: {{ data['punto_critico']['Departamento'] }}</p>
<p>Provincia: {{ data['punto_critico']['Provincia'] }}</p>
<p>Distrito: {{ data['punto_critico']['Distrito'] }}</p>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Inicializar el mapa centrado en el punto crítico
    var punto = {{ data['punto_critico']|tojson }};
    var map = L.map('map').setView([punto['Latitud'], punto['Longitud']], 10); // Zoom adecuado

    // Añadir capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Añadir el punto crítico al mapa
    var puntoMarker = L.marker([punto['Latitud'], punto['Longitud']], {color: 'red'})
        .addTo(map)
        .bindPopup('<b>Punto Crítico:</b> ' + punto['Sector'])
        .openPopup();

    // Añadir embalses al mapa y sus rutas
    var embalses = {{ data['embalses']|tojson }};
    var rutas = {{ data['rutas']|tojson }};

    // Icono personalizado para embalses
    var embalseIcon = L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    embalses.forEach(function(embalse) {
        L.marker([embalse['Latitud'], embalse['Longitud']], {icon: embalseIcon})
            .addTo(map)
            .bindPopup('<b>Embalse:</b> ' + embalse['Nombre de la Presa']);
    });

    // Dibujar rutas óptimas
    rutas.forEach(function(ruta) {
        L.polyline(ruta, {color: 'blue'}).addTo(map);
    });
</script>
</body>
</html>
